<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Magazines de Convocatorias | COTECMAR</title>
    <link rel="icon" href="/assets/logo-cotecmar.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/style.css">
    <script>
        // Auth guard: redirect to login if not authenticated
        (function () {
            const API = window.location.origin;
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) { window.location.replace('/frontend/login.html'); return; }
                // Optimistic check; will be revalidated by auth.js
            } catch { window.location.replace('/frontend/login.html'); }
        })();
    </script>
</head>

<body>
    <!-- Account menu fixed outside header (top-right of page) -->
    <div class="account-fixed">
        <div class="account-wrapper">
            <button id="accountBtn" class="account-btn" type="button">
                <div class="user-info">
                    <span id="headerUserName" class="u-name">Cargando...</span>
                    <span class="u-role">Usuario</span>
                </div>
                <div class="avatar-circle">
                    <i class="fa-solid fa-user"></i>
                </div>
                <i class="fa-solid fa-chevron-down chevron"></i>
            </button>

            <div id="accountDropdown" class="account-dropdown hidden">
                <div class="dropdown-header-info">
                    <p class="dh-name" id="dropdownName">Usuario</p>
                    <p class="dh-email" id="dropdownEmail">user@cotecmar.com</p>
                </div>
                <div class="dropdown-divider"></div>
                <div class="history-section">
                    <div class="history-title"><i class="fa-solid fa-clock-rotate-left"></i> Historial de Flujos</div>
                    <ul id="historyList" class="history-list">
                        <li class="history-empty">Cargando historial...</li>
                    </ul>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-footer">
                    <button id="logoutActionBtn" class="logout-link"><i class="fa-solid fa-right-from-bracket"></i>
                        Cerrar Sesión</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="header">
            <img src="/img/logo-cotecmar.png" alt="COTECMAR" class="logo" />
            <div class="titles">
                <h1 class="title">Generador de Magazines de Convocatorias de Financiación y Eventos</h1>
                <p class="subtitle">Genere revistas automáticas con flujos de IA sobre cualquier tema</p>
            </div>
            <!-- Menú de Cuenta movido fuera del header (ver .account-fixed) -->

            <!-- Mini Loader (esquina superior izquierda) -->
            <div id="flow-mini-loader" aria-live="polite" role="status"></div>

            <!-- MODAL DE FAVORITOS (REESTRUCTURADO) -->
            <div id="favoritesModal" class="favorites-modal-overlay hidden">
                <div class="favorites-modal">
                    <div class="modal-header">
                        <h4>Seleccionar Favoritos</h4>
                        <button id="closeFavoritesModalBtn" class="icon-btn" aria-label="Cerrar"><i
                                class="fa-solid fa-xmark"></i></button>
                    </div>
                    <div class="modal-body">
                        <div id="checklist"></div>
                    </div>
                    <div class="modal-footer">
                        <button id="addFavoritesToRecipients" class="btn-animated-icon">
                            <div class="svg-wrapper-1">
                                <div class="svg-wrapper">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                        <path fill="none" d="M0 0h24v24H0z"></path>
                                        <path
                                            d="M11 11V7h2v4h4v2h-4v4h-2v-4H7v-2h4zm1 11C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                            <span>Añadir</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Panel del Carrito de PDF -->
            <div id="pdfCartPanel" class="glass-panel hidden" aria-hidden="true">
                <div class="glass-header">
                    <button id="closePdfCart" class="icon-btn" aria-label="Cerrar"><i
                            class="fa-solid fa-xmark"></i></button>
                    <h3>Convocatorias y/o Eventos Seleccionadas</h3>
                </div>
                <div class="glass-body">
                    <ol id="pdfCartList" class="pdf-cart-list">
                        <!-- Items agregados por JS -->
                    </ol>
                </div>
                <div class="glass-footer">
                    <button id="generatePdfFromCart" class="btn-animated-icon" type="button">
                        <div class="svg-wrapper-1">
                            <div class="svg-wrapper">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                    <path fill="none" d="M0 0h24v24H0z"></path>
                                    <path
                                        d="M22 15.04C22 17.23 20.24 19 18.07 19H5.93C3.76 19 2 17.23 2 15.04C2 13.07 3.43 11.44 5.31 11.14C5.28 11 5.27 10.86 5.27 10.71C5.27 9.33 6.38 8.2 7.76 8.2C8.37 8.2 8.94 8.43 9.37 8.8C10.14 7.05 11.13 5.44 13.91 5.44C17.28 5.44 18.87 8.06 18.87 10.83C18.87 10.94 18.87 11.06 18.86 11.17C20.65 11.54 22 13.13 22 15.04z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <span>Generar PDF</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Modal de Autenticación -->
        <div id="authModal" class="glass-panel hidden" aria-hidden="true" style="max-width:420px;">
            <div class="glass-header">
                <button id="closeAuthModal" class="icon-btn" aria-label="Cerrar" type="button"><i
                        class="fa-solid fa-xmark"></i></button>
                <h3>Autenticación</h3>
            </div>
            <div class="glass-body">
                <label class="block-label">Email</label>
                <input id="authEmail" type="email" placeholder="admin@acme.com" />
                <label class="block-label">Contraseña</label>
                <input id="authPass" type="password" placeholder="••••••••" />
                <label class="block-label">Nombre (Registro opcional)</label>
                <input id="authName" type="text" placeholder="Admin" />
                <div id="authError" style="color:#b91c1c;margin-top:8px;"></div>
            </div>
            <div class="glass-footer" style="display:flex;gap:12px;justify-content:flex-end;">
                <button id="doRegister" class="btn-animated-icon" type="button"><span>Registrar</span></button>
                <button id="doLogin" class="btn-animated-icon" type="button"><span>Entrar</span></button>
            </div>
        </div>

        <!-- =========== CONTENEDOR DE BOTONES MODIFICADO =========== -->
        <div class="actions-wrapper">
            <div class="actions-top-row">
                <div class="sp">
                    <button type="button" id="generateBtn" class="sparkle-button">
                        <span class="spark"></span>
                        <span class="backdrop"></span>
                        <svg class="sparkle" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M14.187 8.096L15 5.25L15.813 8.096C16.0231 8.83114 16.4171 9.50062 16.9577 10.0413C17.4984 10.5819 18.1679 10.9759 18.903 11.186L21.75 12L18.904 12.813C18.1689 13.0231 17.4994 13.4171 16.9587 13.9577C16.4181 14.4984 16.0241 15.1679 15.814 15.903L15 18.75L14.187 15.904C13.9769 15.1689 13.5829 14.4994 13.0423 13.9587C12.5016 13.4181 11.8321 13.0241 11.097 12.814L8.25 12L11.096 11.187C11.8311 10.9769 12.5006 10.5829 13.0413 10.0423C13.5819 9.50162 13.9759 8.83214 14.186 8.097L14.187 8.096Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path
                                d="M6 14.25L5.741 15.285C5.59267 15.8785 5.28579 16.4206 4.85319 16.8532C4.42059 17.2858 3.87853 17.5927 3.285 17.741L2.25 18L3.285 18.259C3.87853 18.4073 4.42059 18.7142 4.85319 19.1468C5.28579 19.5794 5.59267 20.1215 5.741 20.715L6 21.75L6.259 20.715C6.40725 20.1216 6.71398 19.5796 7.14639 19.147C7.5788 18.7144 8.12065 18.4075 8.714 18.259L9.75 18L8.714 17.741C8.12065 17.5925 7.5788 17.2856 7.14639 16.853C6.71398 16.4204 6.40725 15.8784 6.259 15.285L6 14.25Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path
                                d="M6.5 4L6.303 4.5915C6.24777 4.75718 6.15472 4.90774 6.03123 5.03123C5.90774 5.15472 5.75718 5.24777 5.5915 5.303L5 5.5L5.5915 5.697C5.75718 5.75223 5.90774 5.84528 6.03123 5.96877C6.15472 6.09226 6.24777 6.24282 6.303 6.4085L6.5 7L6.697 6.4085C6.75223 6.24282 6.84528 6.09226 6.96877 5.96877C7.09226 5.84528 7.24282 5.75223 7.4085 5.697L8 5.5L7.4085 5.303C7.24282 5.24777 7.09226 5.15472 6.96877 5.03123C6.84528 4.90774 6.75223 4.75718 6.697 4.5915L6.5 4Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <span class="Text">Generar Magazine</span>
                    </button>
                    <div class="bodydrop"></div>
                    <span aria-hidden="true" class="particle-pen">
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <svg class="particle" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.937 3.846L7.75 1L8.563 3.846C8.77313 4.58114 9.1671 5.25062 9.70774 5.79126C10.2484 6.3319 10.9179 6.72587 11.653 6.936L14.5 7.75L11.654 8.563C10.9189 8.77313 10.2494 9.1671 9.70874 9.70774C9.1681 10.2484 8.77413 10.9179 8.564 11.653L7.75 14.5L6.937 11.654C6.72687 10.9189 6.3329 10.2494 5.79226 9.70874C5.25162 9.1681 4.58214 8.77413 3.847 8.564L1 7.75L3.846 6.937C4.58114 6.72687 5.25062 6.3329 5.79126 5.79226C6.3319 5.25162 6.72587 4.58214 6.936 3.847L6.937 3.846Z"
                                fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </span>
                </div>
                <button type="button" id="generateOptionsBtn" class="options-btn" aria-label="Opciones de generación">
                    <i class="fa-solid fa-sliders"></i>
                </button>
            </div>
            <button type="button" id="showSavedBtn" class="button-secondary uiverse-btn">
                Ver Convocatorias Guardadas
            </button>
        </div>
        <!-- Nuevo botón flotante para Email -->
        <div class="fab-container email-btn-pos">
            <button id="emailFabBtn" class="Btn email-btn" type="button" title="Enviar PDF por correo">
                <div class="sign">
                    <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                        <path fill="white"
                            d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z">
                        </path>
                    </svg>
                </div>
                <div class="text">Email</div>
            </button>
        </div>
        <!-- ======================================================= -->

        <!-- ======================================================= -->
        <!--    SECCIÓN DE FILTROS Y MAGAZINES GUARDADOS (MODIFICADA)  -->
        <!-- ======================================================= -->
        <div id="savedMagazines" class="hidden">
            <div class="filter-panel">
                <!-- ESTADO (solo visible en guardados) -->
                <div class="filter-group">
                    <h3><i class="fa-solid fa-clock"></i> Estado</h3>
                    <div class="filter-options" id="opps-time-filters">
                        <button data-time="active" id="btnActive" class="active">Activas</button>
                        <button data-time="closed" id="btnClosed">Cerradas</button>
                        <button data-time="range" id="btnRange">Periodo</button>
                        <input type="date" id="startDate" disabled>
                        <input type="date" id="endDate" disabled>
                        <button type="button" id="applyRange" disabled>Aplicar</button>
                    </div>
                </div>

                <!-- CATEGORIES -->
                <div class="filter-group">
                    <h3><i class="fa-solid fa-tags"></i> Categorías</h3>
                    <div class="filter-options" id="category-filters">
                        <button data-filter="all" class="active">Todos</button>
                        <button data-filter="nacional">Nacionales</button>
                        <button data-filter="internacional">Internacionales</button>
                        <button data-filter="evento">Eventos</button>
                    </div>
                </div>
                <div class="controls-row"
                    style="display:flex;gap:16px;align-items:center;justify-content:space-between;">
                    <div class="controls-left" style="display:flex;align-items:center;">
                        <div class="favorite-item" style="padding:8px 12px;">
                            <label class="select-all" style="display:flex;gap:8px;align-items:center;">
                                <input type="checkbox" id="selectAllVisible"> Seleccionar todas (visibles)
                            </label>
                        </div>
                    </div>
                    <div class="controls-right" style="display:flex;gap:12px;align-items:center;">
                        <div class="pagination" id="pagination">
                            <button type="button" id="pagePrev" disabled>Anterior</button>
                            <span id="pageInfo">1 / 1</span>
                            <button type="button" id="pageNext" disabled>Siguiente</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Contenedor unificado para tarjetas -->
        <div id="convocatorias-container"></div>

        <!-- ======== NUEVO LOADER CON PALABRAS ANIMADAS ======== -->
        <div id="loading-overlay" class="hidden">
            <div class="loading">
                <div class="spinnerContainer">
                    <div class="spinner"></div>
                    <div class="loader-text-wrapper">
                        <p class="static-word">CARGANDO</p>
                        <div class="animated-words">
                            <span class="word">convocatorias</span>
                            <span class="word">eventos</span>
                            <span class="word">conferencias</span>
                            <span class="word">summits</span>
                            <span class="word">workshops</span>
                            <span class="word">hackathons</span>
                            <span class="word">convocatorias</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="error hidden" id="error"></div>

        <div class="success hidden" id="successMessage">
            <h2 class="h1">✅ ¡Magazine Generado!</h2>
            <div class="gallery" id="gallery"></div>
        </div>

        <!-- Contenedor para visor PDF (iframe) - ya no se usa al inicio -->
        <div id="magazine-container" style="margin-top: 24px;"></div>



        <!-- Dropdown de opciones (liquid glass) -->
        <div id="optionsPanel" class="glass-panel hidden" aria-hidden="true">
            <div class="glass-header">
                <button id="closeOptions" class="icon-btn" aria-label="Cerrar"><i
                        class="fa-solid fa-xmark"></i></button>
                <h3>Preferencias del tema</h3>
            </div>
            <div class="glass-body">
                <label class="block-label">Tema a tratar</label>
                <div class="options-list">
                    <!-- Opción 1: Seleccionar Todo -->
                    <label class="custom-radio-label">
                        <input type="radio" name="topic" value="all" class="hidden-radio" checked>
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Seleccionar Todo (General)</span>
                    </label>

                    <!-- Opción 2: Ciencia -->
                    <label class="custom-radio-label">
                        <input type="radio" name="topic" value="ciencia" class="hidden-radio">
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Ciencia</span>
                    </label>

                    <!-- Opción 3: Tecnología -->
                    <label class="custom-radio-label">
                        <input type="radio" name="topic" value="tecnologia" class="hidden-radio">
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Tecnología</span>
                    </label>

                    <!-- Opción 4: Inteligencia Artificial -->
                    <label class="custom-radio-label">
                        <input type="radio" name="topic" value="ia" class="hidden-radio">
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Inteligencia Artificial</span>
                    </label>

                    <!-- Opción 5: Naval -->
                    <label class="custom-radio-label">
                        <input type="radio" name="topic" value="naval" class="hidden-radio">
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Naval</span>
                    </label>

                    <!-- Opción 6: Otra (con campo de texto) -->
                    <label class="custom-radio-label other-row">
                        <input type="radio" name="topic" value="other" class="hidden-radio">
                        <div class="custom-radio-button">
                            <div class="tick-mark"></div>
                        </div>
                        <span class="radio-text">Otra</span>
                        <input type="text" id="otherTopic" placeholder="Palabra personalizada" disabled>
                    </label>
                </div>
            </div>
            <div class="glass-footer">
                <button id="saveOptions" class="btn-animated-icon">
                    <div class="svg-wrapper-1">
                        <div class="svg-wrapper">
                            <svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                                <g>
                                    <rect x="12" y="2" width="3" height="4" />
                                    <rect x="8" y="16" width="8" height="1" />
                                    <rect x="8" y="19" width="8" height="1" />
                                    <path
                                        d="M19,0H1C0.4,0,0,0.4,0,1v22c0,0.6,0.4,1,1,1h22c0.6,0,1-0.4,1-1V5L19,0z M6,1h10v6H6V1z M18,22H6v-8h12V22z M22,22h-3v-9H5   v9H2V2h3v6h12V2h1.5L22,5.5V22z" />
                                </g>
                            </svg>
                        </div>
                    </div>
                    <span>Guardar</span>
                </button>
            </div>
        </div>

        <!-- ======== 5. BOTONES FLOTANTES CON CONTENEDOR ======== -->
        <div class="fab-container pdf-cart-pos">
            <button id="pdfCartBtn" class="Btn pdf-cart" title="Descargar PDF con seleccionadas">
                <div class="sign">
                    <svg viewBox="0 0 16 16" width="20" height="20" xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM1.6 11.85H0v3.999h.791v-1.342h.803c.287 0 .531-.057.732-.173.203-.117.358-.275.463-.474a1.42 1.42 0 0 0 .161-.677c0-.25-.053-.476-.158-.677a1.176 1.176 0 0 0-.46-.477c-.2-.12-.443-.179-.732-.179Zm.545 1.333a.795.795 0 0 1-.085.38.574.574 0 0 1-.238.241.794.794 0 0 1-.375.082H.788V12.48h.66c.218 0 .389.06.512.181.123.122.185.296.185.522Zm1.217-1.333v3.999h1.46c.401 0 .734-.08.998-.237a1.45 1.45 0 0 0 .595-.689c.13-.3.196-.662.196-1.084 0-.42-.065-.778-.196-1.075a1.426 1.426 0 0 0-.589-.68c-.264-.156-.599-.234-1.005-.234H3.362Zm.791.645h.563c.248 0 .45.05.609.152a.89.89 0 0 1 .354.454c.079.201.118.452.118.753a2.3 2.3 0 0 1-.068.592 1.14 1.14 0 0 1-.196.422.8.8 0 0 1-.334.252 1.298 1.298 0 0 1-.483.082h-.563v-2.707Zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638H7.896Z" />
                    </svg>
                </div>
                <div class="text">PDFs</div>
            </button>
            <span id="pdfCartCount" class="badge">0</span>
        </div>

        <div class="fab-container sources-btn-pos">
            <button id="sourcesBtn" class="Btn sources-btn" type="button" title="Administrar fuentes">
                <div class="sign">
                    <svg viewBox="0 0 32 32" width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                        <g id="data">
                            <path fill="#333333"
                                d="M16,0C9.256,0,2,2.033,2,6.5v19C2,29.965,9.256,32,16,32c6.743,0,14-2.035,14-6.5v-19   C30,2.033,22.742,0,16,0z M28,25.5c0,2.484-5.373,4.5-12,4.5c-6.628,0-12-2.016-12-4.5v-3.736C6.066,23.893,11.05,25,16,25   c4.95,0,9.934-1.107,12-3.236V25.5z M28,19.5h-0.004c0,0.01,0.004,0.021,0.004,0.031C28,22,22.627,24,16,24c-6.627,0-12-2-12-4.469   c0-0.01,0.004-0.021,0.004-0.031H4v-3.736C6.066,17.893,11.05,19,16,19c4.95,0,9.934-1.107,12-3.236V19.5z M28,13.5h-0.004   c0,0.01,0.004,0.021,0.004,0.031C28,16,22.627,18,16,18c-6.627,0-12-2-12-4.469c0-0.01,0.004-0.021,0.004-0.031H4v-3.436   C6.621,12.061,11.425,13,16,13c4.575,0,9.379-0.939,12-2.936V13.5z M16,11C9.372,11,4,8.984,4,6.5C4,4.014,9.372,2,16,2   c6.627,0,12,2.014,12,4.5C28,8.984,22.627,11,16,11z" />
                            <circle cx="25" cy="26" r="1" fill="#333333" />
                            <circle cx="25" cy="20" r="1" fill="#333333" />
                            <circle cx="25" cy="14" r="1" fill="#333333" />
                        </g>
                    </svg>
                </div>
                <div class="text">Fuentes</div>
            </button>
            <span id="sourcesCount" class="badge">0</span>
        </div>

        <div class="fab-container agent-btn-pos">
            <button id="agentHomeBtn" class="Btn agent-btn" type="button" title="Ir al Agente de Propuestas">
                <div class="sign">
                    <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="white">
                        <path
                            d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 2.18l8 3.6v8.72c0 4.54-3.08 8.79-8 10.05-4.92-1.26-8-5.51-8-10.05V7.78l8-3.6zM11 11v6h2v-6h-2zm0-4v2h2V7h-2z" />
                    </svg>
                </div>
                <div class="text">Agente</div>
            </button>
        </div>
        <!-- ======================================================= -->

        <!-- Panel de administración de Sources -->
        <div id="sourcesPanel" class="glass-panel hidden" aria-hidden="true">
            <div class="glass-header">
                <button id="closeSources" class="icon-btn" aria-label="Cerrar"><i
                        class="fa-solid fa-xmark"></i></button>
                <h3>Fuentes de Investigación</h3>
            </div>
            <div class="glass-body">
                <div class="sources-tabs">
                    <button class="tab-btn active" type="button" data-tab="view">Ver Fuentes</button>
                    <button class="tab-btn" type="button" data-tab="add">Agregar Nueva</button>
                    <button class="tab-btn" type="button" data-tab="ai">Busqueda con IA</button>
                </div>



                <div id="sourcesViewTab" class="sources-tab-content">
                    <div id="sourcesList" class="sources-list"></div>
                </div>

                <div id="sourcesAddTab" class="sources-tab-content hidden">
                    <div class="sources-form">
                        <input type="text" id="srcName" placeholder="Nombre de la fuente">
                        <input type="text" id="srcType" placeholder="Tipo (Nacional o Internacional)">
                        <input type="url" id="srcUrl" placeholder="URL completa">
                        <button id="addSourceBtn" class="btn-animated-icon" type="button">
                            <div class="svg-wrapper-1">
                                <div class="svg-wrapper">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                        <path fill="none" d="M0 0h24v24H0z"></path>
                                        <path
                                            d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-11H7v2h4v4h2v-4h4v-2h-4V7h-2v4z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                            <span>Agregar Fuente</span>
                        </button>
                    </div>
                </div>

                <div id="sourcesAITab" class="sources-tab-content hidden">
                    <div style="margin:12px 0;">
                        <div class="sp">
                            <button type="button" id="aiSearchBtn" class="sparkle-button"
                                style="min-width:auto;padding:8px 14px;">
                                <span class="spark"></span>
                                <span class="backdrop"></span>
                                <svg class="sparkle" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M14.187 8.096L15 5.25L15.813 8.096C16.0231 8.83114 16.4171 9.50062 16.9577 10.0413C17.4984 10.5819 18.1679 10.9759 18.903 11.186L21.75 12L18.904 12.813C18.1689 13.0231 17.4994 13.4171 16.9587 13.9577C16.4181 14.4984 16.0241 15.1679 15.814 15.903L15 18.75L14.187 15.904C13.9769 15.1689 13.5829 14.4994 13.0423 13.9587C12.5016 13.4181 11.8321 13.0241 11.097 12.814L8.25 12L11.096 11.187C11.8311 10.9769 12.5006 10.5829 13.0413 10.0423C13.5819 9.50162 13.9759 8.83214 14.186 8.097L14.187 8.096Z"
                                        fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round">
                                    </path>
                                    <path
                                        d="M6 14.25L5.741 15.285C5.59267 15.8785 5.28579 16.4206 4.85319 16.8532C4.42059 17.2858 3.87853 17.5927 3.285 17.741L2.25 18L3.285 18.259C3.87853 18.4073 4.42059 18.7142 4.85319 19.1468C5.28579 19.5794 5.59267 20.1215 5.741 20.715L6 21.75L6.259 20.715C6.40725 20.1216 6.71398 19.5796 7.14639 19.147C7.5788 18.7144 8.12065 18.4075 8.714 18.259L9.75 18L8.714 17.741C8.12065 17.5925 7.5788 17.2856 7.14639 16.853C6.71398 16.4204 6.40725 15.8784 6.259 15.285L6 14.25Z"
                                        fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round">
                                    </path>
                                    <path
                                        d="M6.5 4L6.303 4.5915C6.24777 4.75718 6.15472 4.90774 6.03123 5.03123C5.90774 5.15472 5.75718 5.24777 5.5915 5.303L5 5.5L5.5915 5.697C5.75718 5.75223 5.90774 5.84528 6.03123 5.96877C6.15472 6.09226 6.24777 6.24282 6.303 6.4085L6.5 7L6.697 6.4085C6.75223 6.24282 6.84528 6.09226 6.96877 5.96877C7.09226 5.84528 7.24282 5.75223 7.4085 5.697L8 5.5L7.4085 5.303C7.24282 5.24777 7.09226 5.15472 6.96877 5.03123C6.84528 4.90774 6.75223 4.75718 6.697 4.5915L6.5 4Z"
                                        fill="black" stroke="black" stroke-linecap="round" stroke-linejoin="round">
                                    </path>
                                </svg>
                                <span class="Text">Iniciar Busqueda</span>
                            </button>
                            <div class="bodydrop"></div>
                        </div>
                    </div>
                    <div id="sourcesAISearchResults" class="sources-search-results"
                        style="margin:8px 0; max-height: 260px; overflow-y: auto;"></div>
                    <div style="margin:8px 0;">
                        <button id="addSelectedSourcesAIBtn" class="btn-animated-icon" type="button"
                            style="min-width:auto;padding:8px 14px;">
                            <div class="svg-wrapper-1">
                                <div class="svg-wrapper">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                        <path fill="none" d="M0 0h24v24H0z"></path>
                                        <path
                                            d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-11H7v2h4v4h2v-4h4v-2h-4V7h-2v4z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                            <span>Agregar Seleccionadas</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================================= -->
    <!--         OVERLAY + PANEL PARA ENVÍO DE CORREO           -->
    <!-- ======================================================= -->
    <div id="modalOverlay" class="modal-overlay hidden" aria-hidden="true"></div>
    <div id="sendEmailPanel" class="glass-panel hidden" aria-hidden="true" data-pdf-url="" data-pdf-path="">
        <div class="glass-header">
            <button id="closeSendEmailPanel" class="icon-btn" type="button" aria-label="Cerrar"><i
                    class="fa-solid fa-xmark"></i></button>
            <h3>Enviar Magazine por Correo</h3>
        </div>
        <div class="glass-body">
            <!-- Área de carga/arrastre de PDF -->
            <div class="email-form-group">
                <label class="block-label">Adjuntar PDF (obligatorio)</label>
                <!-- Estado 1: Área para soltar (visible por defecto) -->
                <div id="fileDropArea" class="file-drop-area">
                    <i class="fa-solid fa-file-arrow-up"></i>
                    <p>Arrastra un archivo PDF aquí o <strong>haz clic para seleccionar</strong></p>
                </div>
                <!-- Estado 2: Previsualización (oculto por defecto) -->
                <div id="filePreview" class="file-preview-container hidden">
                    <div class="file-preview-info">
                        <i class="fa-solid fa-file-pdf"></i>
                        <span class="file-name"></span>
                    </div>
                    <button id="removeFileBtn" class="remove-tag-btn" type="button" title="Quitar archivo">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20">
                            <path d="M6 7h1v9H6V7zm7 0h1v9h-1V7z" />
                            <path d="M3 5h14v1H3z" />
                            <path d="M8 3h4v1H8z" />
                            <path d="M5 6h10l-1 12H6L5 6z" />
                        </svg>
                        <span class="tooltiptext">Quitar</span>
                    </button>
                </div>
                <input type="file" id="fileInput" accept=".pdf" style="display: none;" />
            </div>

            <!-- Remitente con nuevo estilo -->
            <div class="email-form-group">
                <label class="block-label">De:</label>
                <div class="fancy-input-container">
                    <input id="senderInput" type="email" readonly>
                    <button id="editSenderBtn" class="fancy-input-btn edit-btn" type="button" title="Editar">
                        <i class="fa-solid fa-pencil"></i>
                    </button>
                </div>
            </div>

            <!-- Destinatarios con nuevo estilo -->
            <div class="email-form-group">
                <label class="block-label">Para:</label>
                <div class="fancy-input-container">
                    <input id="recipientInput" required placeholder="Añadir correo..." type="email">
                    <button id="addRecipientBtn" class="fancy-input-btn" type="button">Agregar</button>
                </div>
                <div id="recipientTagsContainer" class="recipient-tags-container"></div>
            </div>

            <!-- Botón de favoritos con animación de estrella -->
            <div class="favorites-btn-container">
                <label id="showFavoritesBtn" class="favorite-button-ui">
                    <!-- El checkbox invisible que guarda el estado -->
                    <input type="checkbox" class="hidden-checkbox">

                    <!-- El contenido visible del botón -->
                    <div class="button-content">
                        <div class="button-text">Favoritos</div>
                        <svg class="button-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                            stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z">
                            </path>
                        </svg>
                        <span class="tooltiptext">Mostrar Favoritos</span>
                    </div>
                </label>
            </div>
        </div>
        <div class="glass-footer">
            <button id="sendEmailBtn" class="btn-animated-icon" type="button">
                <div class="svg-wrapper-1">
                    <div class="svg-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                            <path fill="none" d="M0 0h24v24H0z"></path>
                            <path
                                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z">
                            </path>
                        </svg>
                    </div>
                </div>
                <span>Enviar</span>
            </button>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/organizer.js"></script>
    <script src="js/email.js"></script>
    <script src="js/savedMagazines.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Usuario en header/dropdown
            const userNameDisplay = document.getElementById('headerUserName');
            const dropdownName = document.getElementById('dropdownName');
            const dropdownEmail = document.getElementById('dropdownEmail');
            const savedName = localStorage.getItem('user_name') || 'Usuario Invitado';
            const savedEmail = localStorage.getItem('user_email') || 'invitado@cotecmar.com';
            if (userNameDisplay) userNameDisplay.textContent = (savedName || 'Usuario').split(' ')[0];
            if (dropdownName) dropdownName.textContent = savedName || 'Usuario';
            if (dropdownEmail) dropdownEmail.textContent = savedEmail;

            // Toggle del dropdown
            const accountBtn = document.getElementById('accountBtn');
            const accountDropdown = document.getElementById('accountDropdown');
            const logoutActionBtn = document.getElementById('logoutActionBtn');

            if (accountBtn && accountDropdown) {
                accountBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    accountDropdown.classList.toggle('hidden');
                    accountBtn.classList.toggle('active');
                    if (!accountDropdown.classList.contains('hidden')) loadUserHistory();
                });
                document.addEventListener('click', (e) => {
                    if (!accountBtn.contains(e.target) && !accountDropdown.contains(e.target)) {
                        accountDropdown.classList.add('hidden');
                        accountBtn.classList.remove('active');
                    }
                });
            }

            if (logoutActionBtn) {
                logoutActionBtn.addEventListener('click', () => {
                    try {
                        localStorage.removeItem('auth_token');
                        localStorage.removeItem('user_name');
                        localStorage.removeItem('user_email');
                    } catch { }
                    logoutActionBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Cerrando...';
                    setTimeout(() => { window.location.href = '/frontend/login.html'; }, 600);
                });
            }

            async function loadUserHistory() {
                const listContainer = document.getElementById('historyList');
                if (!listContainer) return;
                listContainer.innerHTML = '<li class="history-item" style="justify-content:center;color:#6b7280;font-size:0.8rem;">Cargando datos...</li>';
                try {
                    const res = await fetch('/history');
                    if (!res.ok) throw new Error('HTTP ' + res.status);
                    const data = await res.json();
                    const items = Array.isArray(data.items) ? data.items : [];
                    if (items.length === 0) { listContainer.innerHTML = '<li class="history-item" style="justify-content:center;">Sin actividad reciente</li>'; return; }
                    listContainer.innerHTML = '';
                    items.forEach(item => {
                        let badgeClass = 'status-process', badgeText = 'Procesando', icon = '';
                        const st = (item.status || '').toLowerCase();
                        if (st === 'completed') { badgeClass = 'status-success'; badgeText = 'Completado'; icon = '<i class="fa-solid fa-check"></i>'; }
                        else if (st === 'error' || st === 'failed' || st === 'fail') { badgeClass = 'status-error'; badgeText = 'Fallido'; icon = '<i class="fa-solid fa-circle-exclamation"></i>'; }
                        const li = document.createElement('li');
                        li.className = 'history-item';
                        li.innerHTML = `
                <div class="h-info">
                  <span class="h-name">${(item.name || '').toString().slice(0, 80) || 'Actividad'}</span>
                  <span class="h-date">${item.date ? new Date(item.date).toLocaleString() : ''}</span>
                </div>
                <div class="h-status"><span class="status-badge ${badgeClass}">${icon} ${badgeText}</span></div>
              `;
                        if (item.url) {
                            li.style.cursor = 'pointer';
                            li.addEventListener('click', () => {
                                const pdfUrl = String(item.url);
                                const viewerUrl = `/viewer?file=${encodeURIComponent(pdfUrl)}`;
                                // Abrir visor
                                window.open(viewerUrl, '_blank', 'noopener');
                                // Abrir PDF directo (ligero retraso para evitar bloqueos de popups en algunos navegadores)
                                setTimeout(() => { window.open(pdfUrl, '_blank', 'noopener'); }, 100);
                            });
                        } else {
                            li.addEventListener('click', () => { console.log('Ver detalle', item.id); });
                        }
                        listContainer.appendChild(li);
                    });
                } catch (e) {
                    // Fallback a mock si falla
                    const mockData = [];
                    if (mockData.length === 0) { listContainer.innerHTML = '<li class="history-item" style="justify-content:center;">Sin actividad reciente</li>'; return; }
                }
            }

            // Agent Home Button Handler
            const agentHomeBtn = document.getElementById('agentHomeBtn');
            if (agentHomeBtn) {
                agentHomeBtn.addEventListener('click', () => {
                    const currentHost = window.location.hostname;
                    const protocol = window.location.protocol;
                    let targetUrl = '';

                    if (currentHost.includes('github.dev') || currentHost.includes('csb.app')) {
                        // Codespaces/Cloud environment: replace port in subdomain
                        // Expecting format like: app-name-8000.app.github.dev
                        targetUrl = protocol + '//' + currentHost.replace('-8000', '-8001');
                    } else {
                        // Localhost environment
                        targetUrl = 'http://' + currentHost + ':8001';
                    }

                    window.open(targetUrl, '_blank', 'noopener');
                });
            }
        });
    </script>
</body>

</html>