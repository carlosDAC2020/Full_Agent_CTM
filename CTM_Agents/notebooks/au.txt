 """"""
    print("="*80)
    print("üî¨ TEST COMPLETO DEL AGENTE DE VIGILANCIA TECNOL√ìGICA")
    print("="*80)
    print("üîë Verificando API KEY...", "‚úÖ OK" if os.environ.get("GEMINI_API_KEY") else "‚ùå Falta KEY")
    print()
    
    # ========================================================================
    # PASO 1: INGESTA DE INFORMACI√ìN DE CONVOCATORIA
    # ========================================================================
    
    texto_convocatoria = """
    Asunto: Intenci√≥n de postulaci√≥n - Convocatoria 966 Colombia Inteligente

    Hola,

    He decidido que vamos a aplicar a la "CONVOCATORIA COLOMBIA INTELIGENTE: CIENCIA Y TECNOLOG√çAS CU√ÅNTICAS E INTELIGENCIA ARTIFICIAL PARA LOS TERRITORIOS | Convocatoria 966". Esta es una excelente oportunidad para financiar nuestro proyecto de Investigaci√≥n Aplicada, Desarrollo Tecnol√≥gico e Innovaci√≥n (CTeI).

    La convocatoria est√° dirigida espec√≠ficamente a grupos de investigaci√≥n, academia y startups como la nuestra que est√©n desarrollando soluciones disruptivas. El objetivo principal es impulsar proyectos en tecnolog√≠as cu√°nticas e Inteligencia Artificial que generen un impacto medible y ayuden a cerrar brechas tecnol√≥gicas en los territorios del pa√≠s.

    Entre los beneficios que obtendr√≠amos al participar est√°n:

    El fomento de la transferencia tecnol√≥gica.
    El desarrollo de talento especializado.
    El fortalecimiento de nuestra vinculaci√≥n con la industria y el sector p√∫blico.

    Aunque las fechas de inicio y cierre, as√≠ como el monto exacto de financiamiento, a√∫n aparecen como "No especificados", debemos estar atentos y tener lista la propuesta.

    Puedes consultar m√°s detalles directamente en el enlace oficial:
    https://minciencias.gov.co/convocatorias/convocatoria-colombia-inteligente-ciencia-y-tecnologias-cuanticas-e-inteligencia
    """
    print("-" * 80)
    print("üì• PASO 1: INGESTA DE CONVOCATORIA")
    print("-" * 80)
    
    initial_state = {
        "messages": [HumanMessage(content=texto_convocatoria)],
        "route_decision": "ingest" 
    }

    print("üöÄ Procesando informaci√≥n de la convocatoria...")
    state_after_ingest = await agent.ainvoke(initial_state)

    print("\n‚úÖ Ingesta completada")
    if state_after_ingest.get("call_info"):
        call_info = state_after_ingest["call_info"]
        print(f"   ÔøΩ T√≠tulo: {call_info.title}")
        print(f"   üéØ Objetivo: {call_info.objective[:100] if call_info.objective else 'N/A'}...")
        print(f"   üí∞ Financiamiento: {call_info.funding or 'No especificado'}")
        if call_info.keywords:
            print(f"   üè∑Ô∏è  Keywords: {', '.join(call_info.keywords[:5])}")
    
    # Verificar si se generaron documentos de presentaci√≥n
    if state_after_ingest.get("docs_paths"):
        docs = state_after_ingest["docs_paths"]
        if docs.presentation_oath_md:
            print(f"   üìÑ Presentaci√≥n MD: {docs.presentation_oath_md}")
        if docs.presentation_oath_pdf:
            print(f"   üìÑ Presentaci√≥n PDF: {docs.presentation_oath_pdf}")
        if docs.presentation_oath_pptx:
            print(f"   üìÑ Presentaci√≥n PPTX: {docs.presentation_oath_pptx}")
    
    print()

    # actualizamos el esatdo global de la ejecucion 

    global_state = state_after_ingest

    with open('state_test/state_p1.json', 'w', encoding='utf-8') as archivo:
        json.dump(global_state, archivo, indent=4, ensure_ascii=False, default=json_serializer)
    
    # ========================================================================
    # PASO 2: GENERACI√ìN DE IDEAS DE PROYECTO
    # ========================================================================
    print("-" * 80)
    print("ÔøΩ PASO 2: GENERACI√ìN DE IDEAS DE PROYECTO")
    print("-" * 80)

    global_state["route_decision"] = "proposal_ideas"

    state_after_proposal_ai = await agent.ainvoke(global_state)

    if state_after_proposal_ai["proposal_ideas"]:
        print("-----------------------------------")
        for idea in state_after_proposal_ai["proposal_ideas"].ideas:
            print(f"  titulo : \n {idea.idea_title}")
            print(f"  descripcion : \n {idea.idea_description}")
            print(f"  objetivos : \n ")
            for obj in idea.idea_objectives:
                print(f"    - {obj}")
    else:
        print(" ideas no encontradas ")

    global_state = state_after_proposal_ai
    
    with open('state_test/state_p2.json', 'w', encoding='utf-8') as archivo:
        json.dump(global_state, archivo, indent=4, ensure_ascii=False, default=json_serializer)
    